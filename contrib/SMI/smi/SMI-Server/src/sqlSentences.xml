<root>
	<sentence>
		<!--Descripcion: ... -->
		<code>SRV0001</code>
		<sql>
			SELECT codigo,driver,args 
			FROM transacciones
			ORDER BY codigo
		</sql>
	</sentence>
	<!--========================== Selects =================================-->
	<sentence>
		<!--Descripcion: ... -->
		<code>SEL0001</code>
		<sql>
			SELECT gid,nombre_grupo 
			FROM grupos 
			WHERE mostrable=true
			ORDER BY nombre_grupo 
		</sql>
	</sentence>
	<sentence>
		<!--Descripcion: ... -->
		<code>SEL0002</code>
		<sql>
			SELECT
			uid,trim(u.login) AS login,clave,correo,admin,gid,audit,nombres
			FROM
			usuarios u 
			WHERE u.habilitado=true
			ORDER BY login
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0003</code>
		<sql>
			SELECT trim(u.login) AS login,pv.codigo,pv.nombre,pv.ip,upv.valid_ip, g.nombre_grupo, g.gid
			FROM usuarios u,puntosv pv,usuarios_pventa upv, grupos g
			WHERE u.uid=upv.uid AND pv.codigo=upv.codigo_pventa AND pv.gid=g.gid
			ORDER BY login
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0004</code>
		<sql>
			SELECT * 
			FROM grupos 
			ORDER BY nombre_grupo,zona desc
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0005</code>
		<sql>
			SELECT pv.*,g.nombre_grupo 
			FROM puntosv pv, grupos g 
			WHERE g.gid=pv.gid 
			ORDER BY nombre
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0006</code>
		<sql>
			SELECT 
			u.uid,u.login,u.nombres,u.correo,u.admin,u.audit,u.gid,g.nombre_grupo 
			FROM 
			usuarios u, grupos g 
			WHERE g.gid=u.gid AND g.zona=false AND 
			u.habilitado=true AND g.nombre_grupo&lt;&gt;'COLOCADORES' 
			ORDER BY u.login 
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0007</code>
		<sql>
			SELECT DISTINCT
			u.uid,u.login,u.nombres,u.correo,u.admin,u.audit,u.gid,pv.nombre,upv.valid_ip,g.nombre_grupo
			FROM 
			usuarios u, grupos g, puntosv pv, usuarios_pventa upv
			WHERE 
			g.zona=true AND 
			upv.codigo_pventa=pv.codigo AND 
			g.zona=true AND 
			u.uid=upv.uid AND pv.gid=g.gid
			ORDER BY u.login
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0008</code>
		<sql>
			SELECT 
			nombres,u.correo,u.admin,g.nombre_grupo 
			FROM 
			usuarios u,grupos g 
			WHERE 
			u.login='?' AND u.gid=g.gid AND u.habilitado=true
			ORDER BY nombres
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0009</code>
		<sql>
			SELECT 
			pv.codigo,Upv.valid_ip 
			FROM 
			usuarios u, puntosv pv, usuarios_pventa upv 
			WHERE 
			u.uid=upv.uid AND pv.codigo=upv.codigo_pventa AND u.login='?' 
			ORDER BY pv.codigo
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0010</code>
		<sql>
			SELECT mostrable,zona 
			FROM grupos WHERE nombre_grupo='?'
		</sql>
	</sentence>
    <sentence>
    <!--Descripcion: Consulta la lista de mensajes de un usuario a partir de su login -->
        <code>SEL0011</code>
        <sql>
			SELECT DISTINCT m.fecha,m.hora,u.login,m.asunto,m.confirmado,m.texto AS login 
			FROM usuarios u, mensajes m 
			WHERE u.uid=m.uid_origen AND m.uid_destino=(SELECT uid FROM usuarios WHERE login='?') 
			ORDER BY m.fecha
        </sql>
    </sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0012</code>
		<sql>
			SELECT
			m.fecha,m.hora,g.nombre_grupo,m.asunto,m.texto,m.confirmado
			FROM 
			mensajes m,
			usuarios u, 
			(SELECT m.mid,u.uid as id FROM mensajes m, usuarios u WHERE u.uid=m.uid_destino AND u.login='?') AS foo,
			grupos g
			WHERE 
			m.mid=foo.mid AND 
			u.uid=m.uid_origen AND
			u.gid=g.gid AND 
			foo.id=m.uid_destino AND
			current_date&lt;(fecha+tiempo_vida) AND u.uid&lt;&gt;(SELECT uid FROM usuarios WHERE login='?')
			ORDER BY fecha desc ,hora desc
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0013</code>
		<sql>
			SELECT count(*) AS count
			FROM 
			usuarios u 
			WHERE 
			u.gid=(SELECT gid FROM grupos g WHERE g.nombre_grupo='?')
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0014</code>
		<sql>
			SELECT count(*) AS count
			FROM puntosv  
			WHERE gid=(SELECT gid FROM grupos g WHERE g.nombre_grupo='?')
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0015</code>
		<sql>
			SELECT 
			nombre,ip,nombre_grupo 
			FROM 
			puntosv, grupos 
			WHERE codigo='?' AND grupos.gid=puntosv.gid
			ORDER BY nombre
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0016</code>
		<sql>
			SELECT
			m.mid,m.fecha,m.hora,u.login AS de,bar.name AS para,m.asunto,m.texto,CASE WHEN confirmado='t' THEN 'true' ELSE 'false' END
			FROM
			mensajes m,
			(SELECT uid AS id,login AS name FROM usuarios) AS bar,
			usuarios u
			WHERE 
			m.uid_destino=bar.id AND 
			uid_origen=u.uid AND 
			u.login ILIKE '%?%' AND 
			bar.name ILIKE '%?%'AND 
			fecha='?' AND 
			asunto ILIKE '%?%'
			ORDER BY m.mid
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0017</code>
		<sql>
			SELECT DISTINCT 
			date_part('year',fecha),
			date_part('month', fecha),
			date_part('day', fecha) 
			FROM mensajes
			ORDER BY date_part('month', fecha) 
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0018</code>
		<sql>
			SELECT
			m.mid,m.fecha,m.hora,u.login AS de ,bar.name AS para,m.asunto,m.texto,CASE WHEN confirmado='t' THEN 'true' ELSE 'false' END
			FROM
			mensajes m,
			(SELECT uid AS id,login AS name FROM usuarios) AS bar,
			usuarios u
			WHERE 
			m.uid_destino=bar.id AND 
			uid_origen=u.uid AND 
			fecha&gt;='?' AND fecha&lt;='?' ORDER BY m.fecha
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0019</code>
		<sql>
			SELECT
			m.mid,m.fecha,m.hora,u.login AS de ,bar.name AS para,m.asunto,m.texto,CASE WHEN confirmado='t' THEN 'true' ELSE 'false' END
			FROM
			mensajes m,
			(SELECT uid AS id,login AS name FROM usuarios) AS bar,
			usuarios u
			WHERE 
			m.uid_destino=bar.id AND 
			uid_origen=u.uid AND 
			fecha&gt;=to_date('?', 'YYYY-MM-DD') AND fecha&lt;=(to_date('?', 'YYYY-MM-DD')-1) 
			ORDER BY m.fecha
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0020</code>
		<sql>
			SELECT
			m.mid,m.fecha,m.hora,u.login AS de ,bar.name AS para,m.asunto,m.texto,CASE WHEN confirmado='t' THEN 'true' ELSE 'false' END
			FROM
			mensajes m,
			(SELECT uid AS id,login AS name FROM usuarios) AS bar,
			usuarios u
			WHERE 
			m.uid_destino=bar.id AND 
			uid_origen=u.uid AND 
			fecha='?' ORDER BY m.fecha
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0021</code>
		<sql>
			SELECT
			m.mid,m.fecha,m.hora,u.login AS de ,bar.name AS para,m.asunto,m.texto,CASE WHEN confirmado='t' THEN 'true' ELSE 'false' END
			FROM
			mensajes m,
			(SELECT uid AS id,login AS name FROM usuarios) AS bar,
			usuarios u
			WHERE 
			m.uid_destino=bar.id AND 
			uid_origen=u.uid AND
			u.login ILIKE '%?%' AND 
			bar.name ILIKE '%?%'AND
			asunto ILIKE '%?%'
			ORDER BY m.mid
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0022</code>
		<sql>
			SELECT u.login,u.nombres,pv.nombre AS punto_colocacion,foo.valido AS confirmado FROM (SELECT
			u.login,
			u.nombres,
			(CAST(m.fecha AS timestamp)+m.hora) AS fecha_mensaje,
			m.fecha_confirmacion,
			m.minutos AS minutos_de_vida,
			date_part('minute',(m.fecha_confirmacion - (CAST(m.fecha AS timestamp)+m.hora))) AS diferencia,
			'NO' AS valido
			FROM
			mensajes m,
			usuarios u 
			WHERE 
			date_part('minute',(m.fecha_confirmacion - (CAST(m.fecha AS timestamp)+m.hora))) > m.minutos and u.uid=m.uid_destino AND control=true
			UNION
			SELECT 
			u.login,
			u.nombres,
			(CAST(m.fecha AS timestamp)+m.hora) AS fecha_mensaje,
			null AS fecha_confirmacion,
			m.minutos AS minutos_de_vida,
			null AS diferencia,
			'NO' AS valido
			FROM 
			mensajes m, usuarios u
			WHERE 
			u.uid=m.uid_destino AND control=true AND confirmado=false
			UNION
			SELECT
			u.login,
			u.nombres,
			(CAST(m.fecha AS timestamp)+m.hora) AS fecha_mensaje,
			m.fecha_confirmacion,
			m.minutos AS minutos_de_vida,
			date_part('minute',(m.fecha_confirmacion - (CAST(m.fecha AS timestamp)+m.hora))) AS diferencia ,
			'SI' AS valido
			FROM
			mensajes m,
			usuarios u 
			WHERE 
			date_part('minute',(m.fecha_confirmacion - (CAST(m.fecha AS timestamp)+m.hora))) &lt;= m.minutos AND u.uid=m.uid_destino AND control=true)
			AS foo,usuarios u, puntosv pv, usuarios_pventa upv
			WHERE
			u.login=foo.login AND upv.uid=(SELECT uid FROM usuarios WHERE login=foo.login) AND pv.codigo=upv.codigo_pventa AND foo.fecha_mensaje&gt;'?' AND foo.fecha_mensaje&lt;'?'  
			ORDER BY valido,diferencia DESC
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0023</code>
		<sql>SELECT COUNT(*) FROM usuarios WHERE login='?' AND clave='?'</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0024</code>
		<sql>
			SELECT uid FROM usuarios u WHERE login='?' UNION 
			SELECT gid FROM grupos WHERE nombre_grupo='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0025</code>
		<sql>
			SELECT 
				u.uid,login,nombres,correo,
				admin,audit,u.gid,upv.valid_ip,
				pv.nombre,pv.gid AS gidpv,ip,g.nombre_grupo 
			FROM 
				usuarios u ,puntosv pv,usuarios_pventa upv,grupos g 
			WHERE 
				login='?' AND pv.codigo=upv.codigo_pventa AND u.uid=upv.uid AND g.gid=u.gid 
			UNION SELECT 
				u.uid,login,nombres,correo,
				admin,audit,u.gid,false,'sin punto',g.gid,null,g.nombre_grupo 
			FROM 
				usuarios u,grupos g 
			WHERE 
				login='?' AND (admin=true OR audit=true) AND g.gid=u.gid
			ORDER BY login
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0026</code>
		<sql>
			SELECT 
				u.uid,login,nombres,correo,
				admin,audit,u.gid,false,'sin punto',g.gid,null,g.nombre_grupo 
			FROM 
				usuarios u,grupos g 
			WHERE 
				login='?' AND g.gid=u.gid
			ORDER BY login
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0027</code>
		<sql>
			SELECT 
				u.uid,login,nombres,correo,
				admin,audit,u.gid,false,'sin punto',g.gid,null,g.nombre_grupo 
			FROM 
				usuarios u,grupos g 
			WHERE 
				g.gid=u.gid
			ORDER BY login
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0028</code>
		<sql>
			SELECT DISTINCT g.gid,g.nombre_grupo 
			FROM grupos g, usuarios u 
			WHERE u.gid=g.gid AND u.login ILIKE 'CV%'
			ORDER BY g.nombre_grupo
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>SEL0029</code>
		<sql>
			SELECT clave FROM usuarios u WHERE u.login='?'
		</sql>
	</sentence>
	<!--============================= Inserts ===============================-->
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0001</code>
		<sql>
			INSERT INTO 
			usuarios (login,clave,nombres,correo,admin,audit,gid) 
			VALUES ('?','?','?','?','?','?','?');
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0002</code>
		<sql>
			INSERT INTO 
			usuarios_pventa (uid,codigo_pventa,valid_ip) 
			VALUES 
			((SELECT uid FROM usuarios WHERE login='?'),'?','?');
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0003</code>
		<sql>
			INSERT INTO 
			mensajes (uid_destino,uid_origen,fecha,hora,asunto,texto,valido,tiempo_vida,control,minutos) 
			VALUES ('?','?','?','?','?','?','?','?','?','?');
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0004</code>
		<sql>
			INSERT INTO 
			grupos (nombre_grupo,admin) 
			VALUES ('?','?');
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0005</code>
		<sql>
			INSERT INTO 
			usuarios_grupos 
			SELECT u.uid,g.gid FROM usuarios u, grupos g 
			WHERE u.login='?' AND g.nombre_grupo='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0006</code>
		<sql>
			INSERT INTO 
			grupos (nombre_grupo,mostrable,zona) 
			VALUES ('?','?','?')
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>INS0007</code>
		<sql>
			INSERT INTO 
			puntosv (codigo,nombre,ip,gid) 
			VALUES ('?','?','?','?')
		</sql>
	</sentence>
	<!--====================== Delete======================================= -->
	<sentence>
	<!--Descripcion: ... -->
		<code>DEL0001</code>
		<sql>
			DELETE FROM 
			usuarios_pventa 
			WHERE 
			usuarios_pventa.uid='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>DEL0002</code>
		<sql>
			DELETE FROM usuarios WHERE uid='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>DEL0003</code>
		<sql>
			DELETE FROM grupos WHERE nombre_grupo='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>DEL0004</code>
		<sql>
			DELETE FROM puntosv WHERE codigo='?'
		</sql>
	</sentence>
	<!-- ======================== Upate =====================================-->
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0001</code>
		<sql>
			UPDATE 
			grupos SET nombre_grupo='?',mostrable='?',zona='?'  
			WHERE nombre_grupo='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0002</code>
		<sql>
			UPDATE usuarios SET clave='?' WHERE "login"='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0003</code>
		<sql>
			UPDATE mensajes SET confirmado='?', fecha_confirmacion='?'
			WHERE fecha='?' AND hora='?' AND confirmado=false AND
			uid_destino=(SELECT uid FROM usuarios WHERE login='?')
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0004</code>
		<sql>
			UPDATE usuarios SET 
			login='?',clave='?',nombres='?',correo='?',admin='?',audit='?', gid='?' 
			WHERE uid='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0005</code>
		<sql>
			UPDATE usuarios SET 
			habilitado=false,gid=NULL
			WHERE uid='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0006</code>
		<sql>
			UPDATE usuarios_pventa SET codigo_pventa='?' 
			WHERE codigo_pventa=(SELECT codigo FROM puntosv WHERE nombre='?')
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0007</code>
		<sql>
			UPDATE puntosv SET codigo='?',nombre='?',ip='?',gid='?' WHERE nombre='?'
		</sql>
	</sentence>
	<sentence>
	<!--Descripcion: ... -->
		<code>UPD0008</code>
		<sql>
			UPDATE
				usuarios SET gid=foo.gid
			FROM 
				(SELECT pv.gid,up.uid FROM puntosv pv,usuarios_pventa up WHERE pv.codigo=up.codigo_pventa) AS foo 
			WHERE foo.uid=usuarios.uid
		</sql>
	</sentence>
</root>
